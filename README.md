# Telegram Bot с временной почтой

Telegram-бот для создания временных email адресов на основе Mail.gw API с использованием aiogram 3.

## Авторы

### Синельникова Арина 

ИСУ: 467470

### Капленко Алина 

ИСУ: 474301

## Установка

1. Клонируйте репозиторий
2. Создайте виртуальное окружение:
   ```bash
   python -m venv venv
   venv\Scripts\activate  # для Windows
   ```
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
4. Создайте файл `.env` и добавьте ваши настройки:
   ```
   BOT_TOKEN=your_bot_token_here
   ADMIN_IDS=123456789,987654321
   ```
5. Запустите бота:
   ```bash
   python bot.py
   ```

## Структура проекта

Проект организован по современным практикам для Telegram-ботов на aiogram 3:

```
├── bot.py                    # Главный файл запуска бота
├── requirements.txt          # Зависимости Python
├── README.md                # Документация проекта
├── test_api.py              # Тестирование Mail.gw API
├── config/                  # Конфигурация проекта
│   ├── __init__.py          
│   └── settings.py          # Загрузка переменных окружения и настроек
├── filters/                 # Кастомные фильтры для aiogram
│   ├── __init__.py
│   ├── admin_filter.py      # Фильтр для проверки прав администратора
│   └── has_mail_filter.py   # Фильтр проверки наличия активной почты
├── keyboards/               # Клавиатуры для бота
│   ├── __init__.py
│   ├── builders.py          # Reply-клавиатуры (основное меню, админ-панель)
│   └── inline.py            # Inline-клавиатуры для интерактивных сообщений
├── locales/                 # Файлы локализации
│   ├── ru.json              # Русские переводы
│   └── en.json              # Английские переводы
├── logs/                    # Логи работы бота
│   └── bot.log              # Основной лог-файл
├── middlewares/             # Промежуточное ПО (middlewares)
│   ├── __init__.py
│   ├── ban.py               # Middleware для блокировки пользователей
│   ├── language.py          # Middleware определения языка пользователя
│   └── throttling.py        # Middleware антиспама
├── routers/                 # Роутеры (обработчики команд и сообщений)
│   ├── __init__.py
│   ├── admin.py             # Админ-команды и панель управления
│   ├── commands.py          # Основные пользовательские команды
│   └── language.py          # Команды и обработчики смены языка
├── services/                # Внешние сервисы и API
│   └── api_client.py        # Клиент для работы с Mail.gw API
├── states/                  # Состояния для FSM (Finite State Machine)
│   └── __init__.py
├── storage/                 # Локальное хранилище данных
│   ├── user_storage.json    # Данные пользователей (email, токены)
│   └── bot_storage.json     # Данные бота (статистика, бан-лист, рассылки)
└── utils/                   # Вспомогательные функции и утилиты
    ├── __init__.py
    ├── storage_utils.py     # Работа с локальным хранилищем
    ├── storage.py           # Дополнительные функции хранилища
    ├── logger.py            # Настройка системы логирования
    ├── translator.py        # Система переводов и локализации
    └── formatters.py        # Форматирование данных для вывода
```

### Детальное описание модулей:

**Основные файлы:**
- `bot.py` — Точка входа: инициализация, регистрация middlewares/роутеров, graceful shutdown
- `test_api.py` — Скрипт для тестирования Mail.gw API

**Модули по назначению:**
- `config/` — Централизованные настройки (.env, константы)
- `filters/` — Проверка прав доступа и состояний пользователей
- `keyboards/` — UI-элементы для взаимодействия с пользователем
- `middlewares/` — Обработка запросов (бан, язык, антиспам)
- `routers/` — Бизнес-логика команд и обработчиков
- `services/` — Интеграция с внешними API
- `utils/` — Переиспользуемые утилиты

---

## Возможности

### Для пользователей:
- Создание временных email адресов через Mail.gw API
- Просмотр входящих сообщений в реальном времени
- Удаление активных email адресов
- Поддержка многоязычности (русский и английский)
- Интуитивный интерфейс с reply-клавиатурами

### Для администраторов:
- Админ-панель для управления ботом
- Детальная статистика использования
- Массовая рассылка сообщений пользователям
- Система блокировки (бан) пользователей
- Отслеживание активности и метрик

## Команды бота

### Пользовательские команды:
- `/start` — Запуск бота и приветствие
- `/help` — Справка по использованию
- `/newmail` — Создать новый временный email
- `/inbox` — Просмотреть входящие письма
- `/delete` — Удалить активный email адрес
- `/language` — Изменить язык интерфейса

### Админ-команды:
- `/admin` — Открыть админ-панель
- `/stats` — Статистика бота (пользователи, активные сессии, созданные email, забаненные)
- `/broadcast <текст>` — Рассылка сообщения всем пользователям
- `/ban <user_id>` — Заблокировать пользователя по ID

### Админ-панель

Интерактивная панель с кнопками:
- **Статистика** — просмотр метрик бота
- **Рассылка** — инструкции по массовой отправке
- **Забанить пользователя** — инструкции по блокировке
- **Назад** — возврат в основное меню

## Технические детали

### Архитектура:
- **Framework**: aiogram 3.x (современная асинхронная библиотека для Telegram Bot API)
- **API**: Mail.gw для создания временных email адресов
- **Хранение данных**: JSON-файлы для локального хранения
- **Логирование**: Детальные логи всех операций
- **Middleware**: Антиспам, определение языка, блокировка пользователей

### Особенности реализации:
- Модульная архитектура с разделением по роутерам
- Система фильтров для разграничения доступа
- FSM (Finite State Machine) для сложных диалогов
- Мультиязычность: поддерживаются русский и английский языки интерфейса

### Поддерживаемые языки:
- Русский (`ru.json`)
- Английский (`en.json`)

## API

Проект использует **Mail.gw API** для работы с временными email адресами:
- Создание доменов и почтовых ящиков
- Получение входящих сообщений
- Управление активными адресами

## Запуск и развертывание

### Локальный запуск:
```bash
python bot.py
```

### Запуск в фоновом режиме (Linux/macOS):
```bash
nohup python bot.py &
```

### Запуск как сервис (systemd):
```bash
# Создать файл /etc/systemd/system/telegram-bot.service
sudo systemctl enable telegram-bot
sudo systemctl start telegram-bot
```

## Настройка окружения

### Обязательные переменные (.env):
```env
BOT_TOKEN=your_bot_token_here
ADMIN_IDS=123456789,987654321
```

## Мониторинг и логи

Все события записываются в `logs/bot.log`:
- Запуск/остановка бота
- Действия пользователей
- Ошибки и исключения
- Админ-операции

### Просмотр логов в реальном времени:
```bash
tail -f logs/bot.log
```